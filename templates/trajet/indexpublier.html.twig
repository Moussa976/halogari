{% extends 'base.html.twig' %}

{% block title %}Publier un trajet - HaloGari
{% endblock %}

{% block stylesheets %}
	<style>
		.step-section {
			display: none;
			opacity: 0;
			transition: opacity 0.4s ease-in-out;
		}
		.step-section.active {
			display: block;
			opacity: 1;
		}
		.progress-container {
			margin-bottom: 30px;
		}
	</style>
{% endblock %}

{% block body %}
	<div class="container py-5">
		<div class="row justify-content-center mt-3">
			<div class="col-md-6">
				<h2 class="text-center mb-4">Publier un trajet</h2>

				<!-- Barre de progression -->
				<div class="progress-container">
					<div class="progress">
						<div id="progressBar" class="progress-bar" role="progressbar" style="width: 33.33%;" aria-valuenow="33" aria-valuemin="0" aria-valuemax="100">1 / 3</div>
					</div>
				</div>

				<form
					id="publishForm" class="bg-light p-4 rounded shadow-sm border" method="POST" action="{{ path('app_publier') }}">

					<!-- Étape 1/3 -->
					<div class="step-section active" id="step1">
						<h4 class="mb-3">1⁄3 Informations de base</h4>

						<div class="mb-3">
							<div class="input-group">
								<span class="input-group-text text-vert">
									<i class="bi bi-geo-fill"></i>
								</span>
								<div class="form-floating">
									<input list="liste-villes" id="departure" class="form-control villages" name="departure" placeholder="Village de départ" required>
									<label for="departure">Village de départ</label>
								</div>
							</div>
						</div>

						<div class="mb-3">
							<div class="input-group">
								<span class="input-group-text text-vert">
									<i class="bi bi-flag-fill"></i>
								</span>
								<div class="form-floating">
									<input list="liste-villes-arrivee" id="arrival" name="arrival" class="form-control villages" placeholder="Village d'arrivée" required>
									<label for="arrival">Village d'arrivée</label>
								</div>
							</div>
						</div>

						<div class="mb-3">
							<div class="input-group">
								<span class="input-group-text text-vert">
									<i class="bi bi-calendar2-event-fill"></i>
								</span>
								<div class="form-floating">
									<input type="text" id="date" class="form-control dateDepart" name="date" placeholder="Date du trajet" required>
									<label for="date">Date du trajet</label>
								</div>
								<span class="input-group-text text-vert">
									<i class="bi bi-clock-fill"></i>
								</span>
								<div class="form-floating">
									<input type="time" class="form-control" id="heure" name="heure" placeholder="Heure de départ" required>
									<label for="heure">Heure de départ</label>
								</div>
							</div>
						</div>

						<div class="mb-3">
							<div class="input-group">
								<span class="input-group-text text-vert">
									<i class="bi bi-people-fill"></i>
								</span>
								<div class="form-floating">
									<select class="form-select" id="places" name="places">
										{% for i in 1..8 %}
											<option value="{{ i }}">{{ i }}</option>
										{% endfor %}
									</select>
									<label for="places">Nombre de passagers</label>
								</div>
							</div>
						</div>

						<div class="text-end">
							<button type="button" class="btn btn-primary" onclick="nextStep(1)">Suivant</button>
						</div>
					</div>

					<!-- Étape 2/3 -->
					<div class="step-section" id="step2">
						<h4 class="mb-3">2⁄3 Tarif</h4>
						<div class="mb-3">
							<div class="input-group">
								<span class="input-group-text text-vert">
									<i class="bi bi-currency-euro"></i>
								</span>
								<div class="form-floating">
									<input type="number" class="form-control" id="price" name="price" min="1" placeholder="Prix par passager" required>
									<label for="price">Prix par passager (€)</label>
								</div>
							</div>
						</div>
						<div class="d-flex justify-content-between">
							<button type="button" class="btn btn-secondary" onclick="prevStep()">Précédent</button>
							<button type="button" class="btn btn-primary" onclick="nextStep(2)">Suivant</button>
						</div>
					</div>

					<!-- Étape 3/3 -->
					<div class="step-section" id="step3">
						<h4 class="mb-3">3⁄3 Description</h4>
						<div class="mb-3">
							<div class="input-group">
								<span class="input-group-text text-vert">
									<i class="bi bi-chat-left-text-fill"></i>
								</span>
								<div class="form-floating">
									<textarea class="form-control" id="description" name="description" placeholder="Description du trajet" style="height: 100px" required></textarea>
									<label for="description">Description du trajet</label>
								</div>
							</div>
						</div>
						<div class="d-flex justify-content-between">
							<button type="button" class="btn btn-secondary" onclick="prevStep()">Précédent</button>
							<button type="submit" class="btn btn-success">Publier</button>
						</div>
					</div>

				</form>
			</div>
		</div>
	</div>
{% endblock %}

{% block javascripts %}
	<script>
		let currentStep = 1;

function showStep(step) {
document.querySelectorAll('.step-section').forEach((section) => {
section.classList.remove('active');
});
const target = document.getElementById('step' + step);
target.classList.add('active');
updateProgressBar(step);
}

function updateProgressBar(step) {
const progressBar = document.getElementById('progressBar');
const percent = step * 33.33;
progressBar.style.width = percent + '%';
progressBar.setAttribute('aria-valuenow', percent);
progressBar.innerText = step + ' / 3';
}

function nextStep(step) {
const form = document.getElementById('publishForm');
const inputs = document.querySelectorAll('#step' + step + ' input, #step' + step + ' select, #step' + step + ' textarea');
let valid = true;

inputs.forEach(input => {
if (!input.checkValidity()) {
input.classList.add('is-invalid');
valid = false;
} else {
input.classList.remove('is-invalid');
}
});

if (valid) {
currentStep++;
showStep(currentStep);
}
}

function prevStep() {
if (currentStep > 1) {
currentStep--;
showStep(currentStep);
}
}
	</script>
{% endblock %}
